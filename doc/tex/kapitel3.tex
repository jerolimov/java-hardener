%!TEX root = ../Dokumentation.tex

\chapter{Umsetzung}

\begin{itemize}
\item Stack size anpassen?
\item Labels anpassem
\item Toolchain
\item Shell-Script das Class-Dateien bearbeitet.
\item Ein kleines Shell-Script welches den Classloader setzt (für bestimmte Klassen?
\item zB \texttt{javahardener -Dharden=methodcalls -cp … Main}?
\item oder \texttt{jarh -Dharden=methodcalls beispiel.jar}?
\end{itemize}

\section{ASM}

Zur Manipulation von Java Bytecode bietet sich die leichtgewichtige und speziel
dafür entwickelte OpenSource-Bibliothek ASM an. Während der Entwicklung wurden
drei ASM-Libraries mithilfe von Maven eingebunden:

\begin{itemize}
\item Die Kernbibliothek ASM (asm-4.x.jar) bietet Schnittstellen zum Einlesen und Schreiben
		von Class-Dateien mithilfe des Visitor-Patterns.
\item Optional kann ASM durch eine Library zum DOM-basierten Zugriff auf den
		Bytecode erweitert werden (asm-tree-4.x.jar).
\item Häufig verwendete Methoden, etwa zum Ausgeben von Assembler-Code finden
		sich in der ebenfalls optionalen Utility-Erweiterung (asm-util-4.x.jar).
\end{itemize}

\subsection{Maven}

Um die Abhängigkeiten mit Maven runterzuladen kann ein entsprechenden IDE-maven-plugin
verwednet werden oder die IDE Konfiguration mit den folgenden Befehlen erzeugt werden:

\begin{lstlisting}[basicstyle=\ttfamily,backgroundcolor=\color{source}]
	mvn eclipse:clean eclipse:eclipse -DdownloadSources
	mvn idea:clean idea:eclipse
\end{lstlisting}

Supported maven 2+ (tested with maven 3) commands:

\begin{lstlisting}[basicstyle=\ttfamily,backgroundcolor=\color{source}]
	mvn compile # download the dependencies and compile the sources
	mvn package # compiles, test and package the java-hardener sources
\end{lstlisting}

\vspace{0.3cm}


\subsection{Visitor Pattern}

Siehe asm

\subsection{Tree / DOM API}

Siehe asm-tree

\section{ClassLoader}

Siehe JHClassLoader, CheckNullClassVisitor und CheckNullMethodVisitor.

It shall use the ASM (Vgl. http://asm.ow2.org/) bytecode manipulation and analysis framework
and will be implemented as a bytecode-to-bytecode post-processor and maybe also as java \texttt{ClassLoader}.


\section{IFNULL Bytecode manipulation}

Version 1: https://github.com/jerolimov/java-hardener/blob/951f48194f53baebd0915c01e0ed3cc2596bd0db/src/main/java/de/fhkoeln/gm/cui/javahardener/CheckNullMethodVisitor.java\#L43-66

Version 2: https://github.com/jerolimov/java-hardener/blob/749111f5dcc3f71a1d1db5a669591288245e912b/src/main/java/de/fhkoeln/gm/cui/javahardener/CheckNullMethodVisitor.java\#L42-131

Version 3: https://github.com/jerolimov/java-hardener/blob/c6e6bdc7d081eae5e47d2c926073aa3715d908f6/src/main/java/de/fhkoeln/gm/cui/javahardener/CheckNullMethodVisitor.java\#L42-169







